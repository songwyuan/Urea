## LGTV_CTVM20 - èœ±è™«ç—…æ¯’æ„ŸæŸ“RNA-Seqåˆ†æ
# Struction
```
/mnt/alamo01/users/yuansongwei7/LGTV_CTVM20
â”‚
â”œâ”€â”€ README.md                           # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ LICENSE                             # è®¸å¯è¯
â”œâ”€â”€ .gitignore                          # Gitå¿½ç•¥æ–‡ä»¶
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw/
â”‚   â”‚   â”œâ”€â”€ GSE85300/                   # å…¬å…±æ•°æ®é›†ï¼ˆèœ±è™«ç—…æ¯’ç ”ç©¶ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ raw_sra/                # SRAåŸå§‹æ•°æ®
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SRR4011148/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SRR4011149/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”œâ”€â”€ fastq_files/            # è½¬æ¢åçš„fastqæ–‡ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ README_GSE85300.md      # æ•°æ®é›†è¯´æ˜
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ IDE8-LGTV/                  # å®éªŒæ•°æ®ï¼ˆIDE8 vs LGTVæ„ŸæŸ“ï¼‰
â”‚   â”‚       â”œâ”€â”€ IDE8-1_R1.fq.gz         # æ ·æœ¬æ–‡ä»¶ï¼ˆé‡å¤1-3ï¼‰
â”‚   â”‚       â”œâ”€â”€ IDE8-1_R2.fq.gz
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ processed/
â”‚   â”‚   â”œâ”€â”€ QC_results/                 # è´¨æ§ç»“æœ
â”‚   â”‚   â”œâ”€â”€ aligned_bams/               # æ¯”å¯¹ç»“æœ
â”‚   â”‚   â””â”€â”€ counts/                     # åŸºå› è®¡æ•°çŸ©é˜µ
â”‚   â”‚
â”‚   â””â”€â”€ reference/
â”‚       â”œâ”€â”€ Ixodes_scapularis_gca016920785v2.ASM1692078v2.dna.toplevel.fa
â”‚       â”œâ”€â”€ Ixodes_scapularis.gtf
â”‚       â””â”€â”€ Ixodes_scapularis.clean.gtf
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ 01_data_download.sh             # æ•°æ®ä¸‹è½½è„šæœ¬
â”‚   â”œâ”€â”€ 02_quality_control.sh           # è´¨æ§è„šæœ¬ï¼ˆåŸºäºqc.shï¼‰
â”‚   â”œâ”€â”€ 03_alignment.sh                 # æ¯”å¯¹è„šæœ¬ï¼ˆåŸºäºalign_count.shï¼‰
â”‚   â”œâ”€â”€ 04_count_matrix.sh              # è®¡æ•°çŸ©é˜µç”Ÿæˆ
â”‚   â”œâ”€â”€ 05_deseq2_analysis.R            # å·®å¼‚è¡¨è¾¾åˆ†æï¼ˆåŸºäºDESeq2.Rï¼‰
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ config.sh                   # é…ç½®æ–‡ä»¶ï¼ˆè·¯å¾„å’Œå‚æ•°ï¼‰
â”‚
â”œâ”€â”€ analysis/
â”‚   â”œâ”€â”€ notebooks/
â”‚   â”‚   â”œâ”€â”€ 01_quality_metrics.ipynb    # è´¨æ§æŒ‡æ ‡åˆ†æ
â”‚   â”‚   â”œâ”€â”€ 02_alignment_stats.ipynb    # æ¯”å¯¹ç»Ÿè®¡
â”‚   â”‚   â””â”€â”€ 03_deg_analysis.ipynb       # å·®å¼‚è¡¨è¾¾åˆ†æ
â”‚   â”‚
â”‚   â””â”€â”€ reports/
â”‚       â”œâ”€â”€ QC_report.html              # è´¨æ§æŠ¥å‘Š
â”‚       â”œâ”€â”€ alignment_summary.html      # æ¯”å¯¹æ€»ç»“
â”‚       â””â”€â”€ DEG_report.html             # å·®å¼‚è¡¨è¾¾æŠ¥å‘Š
â”‚
â”œâ”€â”€ results/
â”‚   â”œâ”€â”€ differential_expression/
â”‚   â”‚   â”œâ”€â”€ IDE8_vs_LGTV/
â”‚   â”‚   â”‚   â”œâ”€â”€ DEG_results.csv         # å·®å¼‚åŸºå› åˆ—è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ volcano_plot.png        # ç«å±±å›¾
â”‚   â”‚   â”‚   â””â”€â”€ heatmap.png             # çƒ­å›¾
â”‚   â”‚   â””â”€â”€ GSE85300_analysis/          # å…¬å…±æ•°æ®é›†åˆ†æ
â”‚   â”‚
â”‚   â”œâ”€â”€ enrichment/
â”‚   â”‚   â”œâ”€â”€ GO_enrichment/
â”‚   â”‚   â””â”€â”€ KEGG_pathways/
â”‚   â”‚
â”‚   â””â”€â”€ supplementary/
â”‚       â””â”€â”€ literature_data/            # æ–‡çŒ®è¡¥å……æ•°æ®
â”‚           â”œâ”€â”€ Supplementary_Data_1.txt
â”‚           â”œâ”€â”€ Supplementary_Data_2.txt
â”‚           â””â”€â”€ ...
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ methods.md                      # å®éªŒæ–¹æ³•
â”‚   â”œâ”€â”€ sample_info.csv                 # æ ·æœ¬ä¿¡æ¯è¡¨
â”‚   â””â”€â”€ references.bib                  # å‚è€ƒæ–‡çŒ®
â”‚
â””â”€â”€ environment/
    â”œâ”€â”€ environment.yml                 # Condaç¯å¢ƒ
    â”œâ”€â”€ Dockerfile                      # Dockerå®¹å™¨
    â””â”€â”€ requirements.txt                # Pythonä¾èµ–
```


# qc.sh 
```
#!/bin/bash
#PBS -cwd -V
#PBS -l cpu=48:mem=120G
#PBS -q fast
#PBS -N LGTV_IDE8_QC_align

set -euo pipefail

WORKDIR="/mnt/alamo01/users/yuansongwei7/LGTV_CTVM20/IDE8-LGTV"
cd $WORKDIR

mkdir -p results/QC results/bam results/counts results/logs results/star_index

echo "== Step1: Fastp QC =="
for s in IDE8-1 IDE8-2 IDE8-3 LGTV-1 LGTV-2 LGTV-3
do
  echo "Processing $s ..."
  fastp -w 16 \
    -i ${s}_R1.fq.gz -I ${s}_R2.fq.gz \
    -o results/QC/${s}_R1.clean.fq.gz -O results/QC/${s}_R2.clean.fq.gz \
    -h results/QC/${s}.html -j results/QC/${s}.json \
    > results/logs/${s}_fastp.log 2>&1
done
echo "âœ” Fastp completed!"

echo "== Step2: STAR alignment =="
for s in IDE8-1 IDE8-2 IDE8-3 LGTV-1 LGTV-2 LGTV-3
do
  STAR --runThreadN 48 \
    --genomeDir results/star_index \
    --readFilesIn results/QC/${s}_R1.clean.fq.gz results/QC/${s}_R2.clean.fq.gz \
    --readFilesCommand zcat \
    --outFileNamePrefix results/bam/${s}_ \
    --outSAMtype BAM SortedByCoordinate \
    > results/logs/${s}_align.log 2>&1
done
echo "âœ” STAR alignment completed!"

echo "ğŸ‰ QC & Alignment Finished Successfully!"
```

# STARç´¢å¼•å»ºç«‹
```
#!/bin/bash
#PBS -cwd -V
#PBS -l cpu=48:mem=120G
#PBS -q fast
#PBS -N LGTV_align_count

cd /mnt/alamo01/users/yuansongwei7/LGTV_CTVM20/IDE8-LGTV

# ç›®å½•æ£€æŸ¥
mkdir -p results/bam results/counts results/logs results/star_index

# 1. Build STAR index
if [ ! -f results/star_index/Genome ]; then
    STAR --runThreadN 48 \
        --runMode genomeGenerate \
        --genomeDir results/star_index \
        --genomeFastaFiles /mnt/alamo01/users/yuansongwei7/reference/genome.fa \
        --sjdbGTFfile /mnt/alamo01/users/yuansongwei7/reference/genome.gtf \
        --sjdbOverhang 149 \
        > results/logs/star_index.log 2>&1
fi

# 2. STAR alignment
for s in IDE8-1 IDE8-2 IDE8-3 LGTV-1 LGTV-2 LGTV-3
do
  STAR --runThreadN 48 \
    --genomeDir results/star_index \
    --readFilesIn results/QC/${s}_R1.clean.fq.gz results/QC/${s}_R2.clean.fq.gz \
    --readFilesCommand zcat \
    --outFileNamePrefix results/bam/${s}_ \
    --outSAMtype BAM SortedByCoordinate \
    --quantMode GeneCounts \
    > results/logs/${s}_STAR.log 2>&1
done

# 3. featureCounts (æ›´å¯ä¿¡è®¡æ•°)
featureCounts -T 48 -p -t exon -g gene_id \
  -a /mnt/alamo01/users/yuansongwei7/reference/genome.gtf \
  -o results/counts/IDE8_LGTV_counts.txt \
  results/bam/*_Aligned.sortedByCoord.out.bam \
  > results/logs/featureCounts.log 2>&1

echo "ğŸ¯ Alignment + Counting finished!"
```
# STARæ¯”å¯¹
```
#!/bin/bash

# ===== Modify paths (å·²å…¨éƒ¨æ›¿æ¢ä¸ºçœŸå®è·¯å¾„) =====
REF_GENOME=/mnt/alamo01/users/yuansongwei7/LGTV_CTVM20/IDE8-LGTV/reference/Ixodes_scapularis_gca016920785v2.ASM1692078v2.dna.toplevel.fa
REF_GTF=/mnt/alamo01/users/yuansongwei7/LGTV_CTVM20/IDE8-LGTV/reference/Ixodes_scapularis_gca016920785v2.ASM1692078v2.62.gff3
FASTQ_DIR=/mnt/alamo01/users/yuansongwei7/LGTV_CTVM20/IDE8-LGTV
OUTDIR=/mnt/alamo01/users/yuansongwei7/LGTV_CTVM20/STAR_out

mkdir -p $OUTDIR/index $OUTDIR/align $OUTDIR/log

echo "== Step1: Build STAR Index =="
STAR --runThreadN 96 \
    --runMode genomeGenerate \
    --genomeDir $OUTDIR/index \
    --genomeFastaFiles $REF_GENOME \
    --sjdbGTFfile $REF_GTF \
    --sjdbOverhang 149

echo "== Step2: Mapping =="
cd $FASTQ_DIR
for r1 in *_R1.fq.gz; do
    sample=${r1%_R1.fq.gz}
    r2=${sample}_R2.fq.gz

    echo ">>> Mapping: $sample"

    STAR --runThreadN 96 \
        --genomeDir $OUTDIR/index \
        --readFilesIn $r1 $r2 \
        --readFilesCommand zcat \
        --outFileNamePrefix $OUTDIR/align/${sample}_ \
        --outSAMtype BAM SortedByCoordinate \
        --quantMode GeneCounts \
        --limitBAMsortRAM 60000000000 \
        &> $OUTDIR/log/${sample}.log
done

echo "== All Done =="

```
# DESeq2.R
```
#!/usr/bin/env Rscript

library("DESeq2")

# -----------------------------
# 1. æ–‡ä»¶è·¯å¾„
# -----------------------------
count_file <- "/mnt/alamo01/users/yuansongwei7/LGTV_CTVM20/results/counts/counts_matrix_clean.txt"

# -----------------------------
# 2. è¯»å–è®¡æ•°çŸ©é˜µ
# -----------------------------
countData <- read.table(count_file, header = TRUE, row.names = 1, sep = "\t", check.names = FALSE)

# -----------------------------
# 3. æ ·æœ¬ä¿¡æ¯ (colData)
# -----------------------------
samples <- data.frame(
  row.names = colnames(countData),
  condition = c(rep("Mock", 3), rep("LGTV", 3))  # å‰3åˆ— Mock, å3åˆ— LGTV
)

# -----------------------------
# 4. æ„å»º DESeq2 æ•°æ®é›†
# -----------------------------
dds <- DESeqDataSetFromMatrix(countData = countData,
                              colData = samples,
                              design = ~ condition)

# -----------------------------
# 5. è¿‡æ»¤ä½è¡¨è¾¾åŸºå› 
# -----------------------------
dds <- dds[rowSums(counts(dds)) > 1, ]

# -----------------------------
# 6. è¿è¡Œå·®å¼‚åˆ†æ
# -----------------------------
dds <- DESeq(dds)
